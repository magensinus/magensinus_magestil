var expect=chai.expect,stubAjaxLoad=function(a){var n=$.fn.load;$.fn.load=function(e,t){var i=this;return $.fn.load=n,window.setTimeout(function(){i.html(a),t(null,"success")}),this}};!function(l){var e=null,t=function(){e||(e=l("#fixtures").detach()),l("body >:not(#mocha)").remove(),l("body").append(e.clone(!0))},i=function(e){l(window).trigger(l.Event("keyup",{keyCode:e}))},a=function(){i(27)};l.fx.off=!0,l.fn.toJSON=function(){return"jQuery: "+this.selector+" ("+this.length+")"},describe("Featherlight",function(){beforeEach(t),after(t),it("works on items with data-featherlight by default",function(e){expect(l("img")).to.not.be.visible,l("#auto-bound").click(),patiently(e,[function(){expect(l(".featherlight img")).to.be.visible,expect(l(".featherlight img")).to.have.attr("src").equal("fixtures/photo.jpeg"),l(".featherlight").click()},function(){expect(l("img")).to.not.be.visible}])}),it("works on items with data-featherlight by default",function(e){l("body").append('<div id="auto-bound-2" data-featherlight="fixtures/photo.jpeg">Dynamic</div>'),expect(l("img")).to.not.be.visible,l("#auto-bound-2").click(),patiently(e,[function(){expect(l(".featherlight img")).to.be.visible,expect(l(".featherlight img")).to.have.attr("src").equal("fixtures/photo.jpeg"),l(".featherlight").click()},function(){expect(l("img")).to.not.be.visible}])}),it("does not move content that was already placed in the featherlight by content-filters",function(){l.featherlight.contentFilters.advancedExample={process:function(){return l("<p>Hello</p>").appendTo(this.$instance)}},l.featherlight({advancedExample:"dummy"}),expect(l(".featherlight > p").length).to.equal(1)}),describe("jQuery#featherlight",function(){it("is chainable",function(){var e=l("a");expect(e.featherlight()).to.equal(e)}),it("won't open a dialog if the event is already prevented",function(){l("#plain-photo-link").on("click",function(e){e.preventDefault()}).featherlight().click(),expect(l.featherlight.current()).to.be["null"]})}),describe("jQuery.featherlight",function(){it("opens a dialog box",function(){l.featherlight('<p class="testing">This is a test<p>'),expect(l(".featherlight p.testing")).to.be.visible})}),describe("jQuery.featherlight#open",function(){it("returns a promise",function(e){var t=new l.featherlight('<p class="testing">This is a test<p>');expect(l.featherlight.current()).to.be["null"];var i=l.Event("dummy");i.preventDefault(),expect(t.open(i).state()).to.equal("rejected"),expect(l.featherlight.current()).to.be["null"],t.open().then(function(){e()})})}),describe("jQuery.featherlight.current",function(){it("returns null if no dialogbox is currently opened",function(){expect(l.featherlight.current()).to.be["null"],l.featherlight('<p class="testing">This is a test<p>'),l(".featherlight").click(),expect(l.featherlight.current()).to.be["null"],l.featherlight('<p class="testing">This is a test<p>'),l(".featherlight").remove(),expect(l.featherlight.current()).to.be["null"]}),it("returns the featherlight object of the last currently opened dialog",function(){var e=l.featherlight("<p>First<p>");expect(l.featherlight.current()).to.equal(e);var t=l.featherlight("<p>Inner<p>",{namespace:"different_namespace"});expect(l.featherlight.current()).to.equal(t),l(".different_namespace").click(),expect(l.featherlight.current()).to.equal(e)})}),describe("jQuery.featherlight.opened",function(){it("returns [] ]if no dialogbox is currently opened",function(){expect(l.featherlight.opened()).to.eql([]),l.featherlight('<p class="testing">This is a test<p>'),l(".featherlight").click(),expect(l.featherlight.opened()).to.eql([]),l.featherlight('<p class="testing">This is a test<p>'),l(".featherlight").remove(),expect(l.featherlight.opened()).to.eql([])}),it("returns the featherlight objects of the currently opened dialog",function(){var e=l.featherlight("<p>First<p>");expect(l.featherlight.opened()).to.eql([e]);var t=l.featherlight("<p>Inner<p>",{namespace:"different_namespace"});expect(l.featherlight.opened()).to.eql([e,t]),l(".different_namespace").click(),expect(l.featherlight.opened()).to.eql([e])})}),describe("jQuery.featherlight.close",function(){it("closes the currently opened window, if any",function(){l.featherlight('<p class="testing">This is a test<p>'),l.featherlight.close(),expect(l.featherlight.current()).to.be["null"],l.featherlight.close()})}),describe("jQuery.featherlight.close",function(){it("returns a promise",function(e){l.featherlight('<p class="testing">This is a test<p>'),l.featherlight.close().then(function(){e()})})}),describe("image content filter",function(){it("stores the natural width & height",function(e){l("#plain-photo-link").featherlight({afterOpen:function(){expect(this.$content.naturalWidth).to.equal(200),e()}}).click()})}),describe("configuration",function(){it("can be set using data-featherlight-*",function(){l("#data-attr-test a").featherlight().click(),expect(l.featherlight.current()).to.have.properties({variant:"test",closeOnEsc:!1,closeSpeed:42}),expect(l.featherlight.current().$instance.find("b")).to.have.text("Added in callback")}),it("can be set using data-featherlight-* on filtered element too",function(){l("#data-attr-filter-test a:first").click(),expect(l.featherlight.current()).to.have.property("variant").equal("wrapper"),l("#data-attr-filter-test a:last").click(),expect(l.featherlight.current()).to.have.property("variant").equal("inner"),l('<a data-featherlight-variant="dynamic" href=".some-content">z</a>').appendTo(l("#data-attr-filter-test")).click(),expect(l.featherlight.current()).to.have.property("variant").equal("dynamic")}),it("can specify to close or not on escape key",function(){var e=l.featherlight("<p/>"),t=l.featherlight("<p/>"),i=l.featherlight("<p/>",{closeOnEsc:!1});l.featherlight("<p/>",{closeOnEsc:!0});expect(l.featherlight._globalHandlerInstalled).to.be["true"],a(),expect(l.featherlight.current()).to.equal(i),a(),expect(l(".featherlight"))["with"].length(3),l(".featherlight:last").click(),expect(l.featherlight.current()).to.equal(t),a(),expect(l.featherlight.current()).to.equal(e),expect(l.featherlight._globalHandlerInstalled).to.be["true"],l.featherlight.current().close(),expect(l.featherlight._globalHandlerInstalled).to.be["false"]}),it("can specify to a close icon",function(){var e=l.featherlight("<p/>",{closeIcon:'<div class="test">X</div>'});expect(l.featherlight.current()).to.equal(e),l(".test").click(),expect(l.featherlight.current()).to.be["null"]}),it("can specify a key handler",function(){var t;l.featherlight("<p/>",{onKeyUp:function(e){t=e.keyCode}}),i(25),expect(t).to.equal(25),i(27),expect(t).to.equal(25),expect(l.featherlight.current()).to.be["null"]}),it("can specify a resize handler",function(){var e=[],t=function(){l.featherlight("<p/>",{onResize:function(){e.push(this.id)}})};t(),t(),l(window).trigger("resize"),t(),l.featherlight.current().close(),l.featherlight.current().close(),l(window).trigger("resize"),e=l.map(e,function(e){return e-l.featherlight.current().id}),expect(e).to.eql([0,1,1,0,2,0])}),it("can specify a filter for events",function(){l("#filter-test .group").featherlight({filter:".yes",type:"text"}).append('<span class="yes"  href="filter Appended">Photo</span>'),l("#filter-test span").each(function(){l(this).click()}),expect(l(".featherlight"))["with"].length(2),expect(l(".featherlight:first .featherlight-content")).to.contain("filter Yes"),expect(l(".featherlight:last  .featherlight-content")).to.contain("filter Appended")}),it("can specify explicit content",function(){l.featherlight({text:'A <div> & "quoted text"'}),expect(l(".featherlight")).to.contain('A <div> & "quoted text"')}),it("can specify ajax content",function(e){l.featherlight({ajax:"featherlight.html .some-content"}),patiently(e,function(){expect(l(".featherlight")).to.contain("Hello")})}),it("ajax content can be text only",function(e){stubAjaxLoad("Hello <b>world</b>"),l.featherlight({ajax:"stubbed"}),patiently(e,function(){expect(l(".featherlight")).to.contain("Hello")})}),it("can specify an alternate close button selector",function(){var e=l.featherlight('<div>Test<div class="close-me">close</div></div>',{otherClose:".close-me"});expect(l.featherlight.current()).to.equal(e),l(".close-me").click(),expect(l.featherlight.current()).to.be["null"]}),it("can specify an alternate root selector",function(){l.featherlight('<div>Test<div class="close-me">close</div></div>',{root:"#fixtures"}),expect(l("#fixtures").children().last()).to.have["class"]("featherlight")}),it("can specify callbacks to track the progress of the dialog",function(){var i=["beforeOpen","beforeContent","afterContent","afterOpen","beforeClose","afterClose"],a=undefined,n={};l.each(i,function(e,t){n[t]=function(){expect(a).to.equal(i[e-1]),a=t}}),l.featherlight(l("<p>Hello</p>"),n),expect(a).to.equal("afterOpen"),l.featherlight.current().close(),expect(a).to.equal("afterClose")}),it("can be interrupted via beforeOpen",function(){l.featherlight({text:"Hello",beforeOpen:function(){return!1}}),expect(l.featherlight.current()).to.be["null"],l.featherlight.defaults.beforeOpen=function(){return!1},l("#auto-bound").click(),expect(l.featherlight.current()).to.be["null"],l.featherlight.defaults.beforeOpen=l.noop}),it("provides event to beforeClose when close via closebox",function(){l.featherlight({text:"Hello",beforeClose:function(e){expect(e).to.be.an("object")}}),l(".featherlight-close").click()}),it("provides event to beforeClose & al when closed via escape",function(){l.featherlight({text:"Hello",beforeClose:function(e){expect(e).to.be.an("object")}}),a()}),it("passes event to beforeClose & al when closed via global function",function(){l.featherlight({text:"Hello",beforeClose:function(e){expect(e).to.eql(42)}}),l.featherlight.close(42)}),it("can specify a loading text",function(e){stubAjaxLoad("<b>Hi</b>"),l.featherlight({ajax:"stubbed",loading:"Spinner!"}),expect(l(".featherlight")).to.contain("Spinner!"),expect(l(".featherlight")).to.have["class"]("featherlight-loading"),patiently(e,function(){expect(l(".featherlight")).to.contain("Hi"),expect(l(".featherlight")).not.to.contain("Spinner!"),expect(l(".featherlight")).not.to.have["class"]("featherlight-loading")})}),it("can specify a different namespace",function(){l("#namespace-test a").featherlight({namespace:"custom-namespace"}).click(),expect(l.featherlight.current().$instance.find("b")).to.have.text("Namespace ok")}),it("can specify to persist the content",function(){var e=l('<div class="keepme"/>').appendTo("body");expect(l(".keepme"))["with"].length(1).to.have.text("");var t=l.featherlight({jquery:e,persist:!0,afterContent:function(){this.$content.append("<i>1</i>")},afterOpen:function(){this.$content.append("<b>2</b>")}});expect(l(".keepme"))["with"].length(1).to.have.text("12"),l.featherlight.close(),t.open(),expect(l(".keepme"))["with"].length(1).to.have.text("1212"),l.featherlight.close()});var e=function(e,t){l('<div class="keepme">Foo</div>').appendTo("body"),l('<div class="other">Bar</div>').appendTo("body");var i=l('<a href=".keepme"/><a href=".other"/>').appendTo("body");i.featherlight({persist:e}),i.first().click(),l.featherlight.close(),i.first().click(),expect(l(".featherlight-inner")).to.have.text("Foo"),l.featherlight.close(),i.last().click(),expect(l(".featherlight-inner")).to.have.text(t)};it("can specify to persist the content individually",function(){e(!0,"Bar")}),it("can specify to persist the share the content as a group",function(){e("shared","Foo")})}),describe("error handling",function(){it("is quite basic",function(e){l.featherlight("does_not_exist.jpg"),patiently(e,function(){expect(l(".featherlight-image")).to.have.attr("src").equal("does_not_exist.jpg"),expect(l(".featherlight")).not.to.have["class"]("featherlight-loading")})})}),describe("iframe content filter",function(){it("generates an iframe with the right attributes and css",function(e){l('<a data-featherlight-iframe="#test-iframe" data-featherlight-iframe-allowfullscreen="true" data-featherlight-iframe-width="323" data-featherlight-iframe-min-height="212">').featherlight().click(),expect(l(".featherlight iframe")).to.have.attr("src").equal("#test-iframe"),expect(l(".featherlight iframe")).to.have.css("width").equal("323px"),expect(l(".featherlight iframe")).to.have.css("min-height").equal("212px"),expect(l(".featherlight iframe")).to.have.attr("allowfullscreen").equal("true"),expect(l(".featherlight iframe")).not.to.have.attr("min-height"),patiently(e,function(){expect(l(".featherlight")).to.have.attr("class").equal("featherlight featherlight-iframe")})}),it('allows "about:blank"',function(){l('<a data-featherlight-iframe="about:blank">').featherlight().click(),expect(l(".featherlight iframe")).to.have.attr("src").equal("about:blank")})}),describe("accessibility",function(){it("has a focusable close button",function(){l.featherlight({text:"Hello"}),close=l(".featherlight-close-icon"),close.focus(),expect(l(".featherlight-close-icon").attr("tabindex")).to.be.undefined,expect(l(document.activeElement)).to.have["class"]("featherlight-close-icon")}),it("removes focus and then resets it",function(){l(".for-focus").focus(),l.featherlight({text:"Hello"}),expect(l(".for-focus")).to.have.attr("tabindex","-1"),expect(l(document.activeElement)).not.to.have["class"]("for-focus"),l.featherlight.close(),expect(l(document.activeElement)).to.have["class"]("for-focus"),expect(l(".for-focus").attr("tabindex")).to.be.undefined}),it("resets tabindex properly",function(){l(".for-focus").attr("tabindex",42),l.featherlight({text:"Hello"}),l.featherlight.close(),expect(l(".for-focus")).to.have.attr("tabindex").equal("42")}),it('focussed on "autofocus" content, if any',function(){l.featherlight({html:'<input><input autofocus class="ok">'}),expect(l(document.activeElement)).to.have["class"]("ok"),l.featherlight.close()}),it('sets the "with-featherlight" class correctly on html',function(){expect(l("html")).not.to.have["class"]("with-featherlight"),l.featherlight({html:"hello"}),expect(l("html")).to.have["class"]("with-featherlight"),l.featherlight({html:"hello"}),l.featherlight.close(),l.featherlight.close(),expect(l("html")).not.to.have["class"]("with-featherlight")}),it("works correctly with filters [#235]",function(){var t=!1,e=function(e){t=!e.isDefaultPrevented()};l(document).on("click",e),l("#bug-235 .unrelated").click(),l(document).off("click",e),expect(t).to.eql(!0)})})})}(jQuery);